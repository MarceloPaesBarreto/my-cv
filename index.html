<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>

<!-- Google Translate Integration -->
<script type="text/javascript">
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({
            pageLanguage: 'en',
            includedLanguages: 'en,pt,fr,de,pl,es',
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false
        }, 'google_translate_element');
        
        // Connect flag buttons to Google Translate
        setTimeout(function() {
            const langMap = {
                'en': 'English',
                'pt': 'Portuguese',
                'fr': 'French', 
                'de': 'German',
                'pl': 'Polish',
                'es': 'Spanish'
            };
            
            document.querySelectorAll('.language-flag').forEach(flag => {
                flag.addEventListener('click', function(e) {
                    e.preventDefault();
                    const lang = this.getAttribute('data-lang');
                    const googleCombo = document.querySelector('.goog-te-combo');
                    if (googleCombo) {
                        // Find the option with text content matching our language
                        for (let i = 0; i < googleCombo.options.length; i++) {
                            if (googleCombo.options[i].text.includes(langMap[lang])) {
                                googleCombo.selectedIndex = i;
                                googleCombo.dispatchEvent(new Event('change'));
                                break;
                            }
                        }
                    }
                });
            });
        }, 1000);
    }
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
    // Dark mode toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM loaded - Setting up dark mode");
        const toggleBtn = document.getElementById('toggle');
        
        if (toggleBtn) {
            function enableDarkMode() {
                document.body.classList.add('dark-mode');
                toggleBtn.classList.add('dark');
                localStorage.setItem('darkMode', 'enabled');
            }
            
            function disableDarkMode() {
                document.body.classList.remove('dark-mode');
                toggleBtn.classList.remove('dark');
                localStorage.setItem('darkMode', null);
            }
            
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'enabled') {
                enableDarkMode();
            }
            
            toggleBtn.addEventListener('click', function() {
                console.log("Toggle clicked");
                if (document.body.classList.contains('dark-mode')) {
                    disableDarkMode();
                } else {
                    enableDarkMode();
                }
            });
        }
        
        // Animate progress bars on scroll
        const progressBars = document.querySelectorAll('.progress');
        
        const animateProgressBars = () => {
            progressBars.forEach(bar => {
                const position = bar.getBoundingClientRect().top;
                const screenPosition = window.innerHeight / 1.3;
                
                if (position < screenPosition) {
                    const width = bar.parentElement.nextElementSibling.textContent;
                    bar.style.width = width;
                }
            });
        };
        
        window.addEventListener('scroll', animateProgressBars);
        animateProgressBars();
        
        // Handle reference form submission
        const submitBtn = document.getElementById('ref_submit_button');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                handleReferenceSubmission();
            });
        }
        
        // Handle contact form
        const contactForms = document.querySelectorAll('.contact-form');
        contactForms.forEach(form => {
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('This is a demonstration. In a real implementation, this form would submit data.');
                form.reset();
            });
        });
    });
    
    // Reference form handling
    function handleReferenceSubmission() {
        // Get form values
        const name = document.getElementById('ref_name_field').value;
        const company = document.getElementById('ref_company_field').value;
        const position = document.getElementById('ref_position_field').value;
        const code = document.getElementById('ref_code_field').value;
        const text = document.getElementById('ref_text_field').value;
        
        // Check if all fields are filled
        if (!name || !company || !position || !code || !text) {
            showReferenceMessage('Please fill out all fields', 'error');
            return;
        }
        
        console.log('Reference submission:', { name, company, position });
        
        // Check reference code
        if (code !== 'Marcelo1984') {
            showReferenceMessage('Invalid reference code. Please check and try again.', 'error');
            return;
        }
        
        // Create GitHub issue
        const issueTitle = `New Reference from ${name} (${company})`;
        const issueBody = `
## New Reference Submission

**Name:** ${name}
**Position:** ${position}
**Company:** ${company}
**Text:** "${text}"

---
*Submitted on: ${new Date().toISOString()}*
        `;
        
        // GitHub issues URL
        const issuesUrl = 'https://github.com/MarceloPaesBarreto/my-cv/issues/new';
        const url = `${issuesUrl}?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}&labels=reference`;
        
        // Show success message
        showReferenceMessage('Thank you! Your reference has been submitted for approval.', 'success');
        
        // Clear form fields
        document.getElementById('ref_name_field').value = '';
        document.getElementById('ref_company_field').value = '';
        document.getElementById('ref_position_field').value = '';
        document.getElementById('ref_code_field').value = '';
        document.getElementById('ref_text_field').value = '';
        
        // Open GitHub issue page in new tab
        window.open(url, '_blank');
    }
    
    function showReferenceMessage(message, type) {
        const messageElement = document.getElementById('ref_message');
        if (!messageElement) return;
        
        messageElement.textContent = message;
        
        if (type === 'error') {
            messageElement.className = 'mt-3 p-3 rounded bg-red-100 text-red-700';
        } else {
            messageElement.className = 'mt-3 p-3 rounded bg-green-100 text-green-700';
        }
        
        messageElement.classList.remove('hidden');
        
        // Hide the message after 5 seconds
        setTimeout(function() {
            messageElement.classList.add('hidden');
        }, 5000);
    }
</script>
